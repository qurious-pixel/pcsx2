#!/bin/bash

export LD_LIBRARY_PATH="/tmp/PCSX2:$APPDIR/usr/lib:$LD_LIBRARY_PATH"
BINARY_NAME=$(basename "$ARGV0")
if [[ ! -e "$PWD/$BINARY_NAME.config" ]]; then
        mkdir "$PWD/$BINARY_NAME.config"
fi       
export XDG_CONFIG_HOME="$PWD/$BINARY_NAME.config"

ln -sf $APPDIR/usr/bin/plugins /tmp/PCSX2 
mkdir -p $HOME/.local/share/icons/hicolor/scalable/apps && cp $APPDIR/PCSX2.png $HOME/.local/share/icons/hicolor/scalable/apps

if [ "$(ldd /tmp/PCSX2/libGSdx.so | grep "not found" | awk ' { print $1 } ')" = "libOpenGL.so.0" ]]; then
        export LD_PRELOAD=$APPDIR/usr/bin/vm/libOpenGL.so.0
fi

$APPDIR/AppRun-patched

unlink /tmp/PCSX2
